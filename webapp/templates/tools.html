{% extends "page-skeleton.html" %}

{% block head %}
	{{ super() }}
	<script type="text/javascript" src="static/javascript/wordpressInstall.js"></script>
	<script type="text/javascript" src="static/javascript/databaseTools.js"></script>
	<link rel="stylesheet" href="static/css/wordpress.css"></link>
	<style>
		li a.logout-button {
			display: inline-block;
		}
	</style>
{% endblock %}

{% block body %}
	{{ super() }}
	{# these are the tab headers just under the navbar. Each header must have a corresponding
	div.col.s12 below #}
	<div class="col s12">
		<ul class="tabs">
			<div class="indicator teal lighten-2" style="z-index:1">{# this changes the tab colors #}</div>
			<li class="tab">
				<a class="active teal-text lighten-2" href="#mysql">MySQL</a>
			</li>
			<li class="tab">
				<a class="teal-text lighten-2" href="#backups">Backups</a>
			</li>
			<li class="tab">
				<a class="teal-text lighten-2" href="#wordpress">Wordpress</a>
			</li>
			<li class="tab">
				<a class="teal-text lighten-2" href="#help">Help</a>
			</li>
		</ul>
	</div>

	{# This stuff is the MySQL tab #}
	<div id="mysql" class="col s12">
		<div class="card z-depth-3" style="min-height: 400px;width:60%;margin-left:auto;margin-right:auto;margin-top:2%;padding-bottom: 3%;">
			<div class="card-content">
				<span class="card-title">MySQL Databases</span>
				{% if databases|length > 0 %}
					<ul class="collection">
						{% for db in databases %}
							<li class="collection-item">
								<div>
									{{ db }}
									<div onclick="databaseForm('{{ db }}')" class="activator secondary-content">
										<i class="material-icons">delete</i>
									</div>
								</div>
							</li>
						{% endfor %}
					</ul>
				{% else %}
					<p> No Databases to show &nbsp;&nbsp; O_o </p><br>
				{% endif %}
				
				<a class="activator left btn waves-effect waves-light" onclick="passwordReset(false)">Reset MySQL Password&nbsp;&nbsp;<i class="material-icons">settings_backup_restore</i></a>
				<a class="activator right btn-floating halfway-fab waves-effect waves-light teal"><i class="material-icons">add</i></a>
				<br><br>
				<span style="display:block;" class="error-msg">{{ mysql_error }}</span>
				{% if new_mysql_password %}
				<p style="color:green;">Your new MySQL password: {{ new_mysql_password }}</p>
				{% endif %}
			</div>

			{# card reveals are what come up when you click something with class "activator".
			The Javascript in the header does the necessary things to pick the correct form
			and change the form as need be. Normally, there is only one "card-reveal" so this
			is a bit of a hack #}
			<div class="card-reveal" style="overflow: hidden;">
				<div id="database-change-form">
					<span class="card-title" onclick="databaseForm('')">
						<span id="database-form-title">New Database:</span>
						<i class="material-icons right">close</i>
					</span>
					<form action="/createdb" method="POST">
						<div class="input-field">
							<input autocomplete="off" id="username" type="text" name="username">
							<label for="username">Server username</label>
						</div>
						<div class="input-field">
							<input autocomplete="off" id="password" type="password" name="password">
							<label for="password">Server password</label>
						</div>
						<div class="input-field">
							<input autocomplete="off" id="dbname" type="text" name="dbname">
							<label for="dbname">Database name</label>
						</div>
						<button class="btn waves-effect waves-light" type="submit">
							<span id="database-form-button-text"> Create </span>
							<i class="mdi-content-send right"></i>
						</button>
					</form>
				</div>
				<div id="password-reset-form" style="display: none;">
					<span class="card-title" onclick="passwordReset(true)">
						<span>Reset MySQL Password:</span>
						<i class="material-icons right">close</i>
					</span>
					<form action="/resetpw" method="POST">
						<div class="input-field" method="POST">
							<input autocomplete="off" id="username" type="text" name="username">
							<label for="username">Server username</label>
						</div>
						<div class="input-field">
							<input autocomplete="off" id="password" type="password" name="password">
							<label for="password">Server password</label>
						</div>
						<button class="btn waves-effect waves-light" type="submit">
							<span id="database-form-button-text"> Reset </span>
							<i class="mdi-content-send right"></i>
						</button>
					</form>
				</div>
			</div>
		</div>
	</div>


	<div id="backups" class="col s12">
		<p> Need backs of your home directory? Here you go brah </p>
	</div>

	{# This stuff is the Wordpress tab #}
	<div id="wordpress" class="col s12">
		<div class="card z-depth-3" id="wordpress-install-container">
			<div class="card-content">
				<span class="card-title">Manage Your WordPress Site</span>
				<img src="/static/wordpress-logo-stacked-rgb.png" id="wordpress-image"/> 

				{% if WORDPRESS_EXISTS %}

				<p id="wordpress-link">WordPress is installed.
					<b>Visit your WordPress site 
					<a href="{{ WORDPRESS_LINK }}" target="_blank">here</a><b>
				</p>

				{% else %}

				<p id="wordpress-install-description">Would you like to install wordpress to your web space?</p>

				<button class="btn waves-effect waves-light" id="wordpress-install-button" onclick="installWordpress()">
					<span>Install</span>
					<i class="mdi-content-send right"></i>
				</button>

				<p id="wordpress-setup-link">WordPress is installed.
					<b>Visit your WordPress site 
					<a href="{{ WORDPRESS_LINK }}" target="_blank">here</a><b>
				</p>

				<div class="progress" id="wordpress-progress">
						<div class="indeterminate"></div>
				</div>

				{% endif %}
			</div>
		</div>	
	</div>


	<div id="help" class="col s12">
		<p> Generic section where users can contact a sys admin with their problems </p>
	</div> 
{% endblock %}
